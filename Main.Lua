--[[
	Script BY Azka - Ultimate Controller (Kavo-like UI)
	- Menggunakan gaya UI Kavo dengan sidebar, tab, section, dan elemen-elemen modern.
	- Semua fitur sebelumnya diintegrasikan ke dalam UI ini.
	- UI ditempatkan dalam folder "Main_Script_By_Azka" di CoreGui.
	- Folder lama dihapus otomatis saat load.
]]

-- Hapus folder lama jika ada
local CoreGui = game:GetService("CoreGui")
local folderName = "Main_Script_By_Azka"
local oldFolder = CoreGui:FindFirstChild(folderName)
if oldFolder then oldFolder:Destroy() end

-- Buat folder baru
local folder = Instance.new("Folder")
folder.Name = folderName
folder.Parent = CoreGui

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Camera = workspace.CurrentCamera

local player = Players.LocalPlayer

-- ========== UTILITY FUNCTIONS ==========
local function waitForHumanoid()
	local char = player.Character or player.CharacterAdded:Wait()
	local hum = char:FindFirstChildWhichIsA("Humanoid")
	while not hum do
		char = player.Character or player.CharacterAdded:Wait()
		hum = char:FindFirstChildWhichIsA("Humanoid")
		task.wait(0.05)
	end
	return hum
end

local function makeDraggable(frame, dragHandle)
	dragHandle = dragHandle or frame
	local dragging = false
	local dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
	dragHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or
		   input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or
		                 input.UserInputType == Enum.UserInputType.Touch) then
			update(input)
		end
	end)
end

-- ========== THEME ==========
local theme = {
	SchemeColor = Color3.fromRGB(74, 99, 135),
	Background = Color3.fromRGB(36, 37, 43),
	Header = Color3.fromRGB(28, 29, 34),
	TextColor = Color3.fromRGB(255, 255, 255),
	ElementColor = Color3.fromRGB(32, 32, 38)
}

-- ========== UI LIBRARY ==========
local Library = {}
Library.Flags = {}  -- untuk menyimpan state toggle dll.

-- Fungsi membuat window utama
function Library:CreateWindow(title)
	local window = {}
	local gui = Instance.new("ScreenGui")
	gui.Name = "AzkaUI"
	gui.Parent = folder
	gui.ResetOnSpawn = false
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	-- Main frame
	local main = Instance.new("Frame")
	main.Name = "Main"
	main.Parent = gui
	main.BackgroundColor3 = theme.Background
	main.BorderSizePixel = 0
	main.Position = UDim2.new(0.5, -250, 0.5, -200)
	main.Size = UDim2.new(0, 500, 0, 400)
	main.ClipsDescendants = true
	Instance.new("UICorner", main).CornerRadius = UDim.new(0, 6)
	makeDraggable(main, main)

	-- Header
	local header = Instance.new("Frame")
	header.Name = "Header"
	header.Parent = main
	header.BackgroundColor3 = theme.Header
	header.Size = UDim2.new(1, 0, 0, 30)
	header.BorderSizePixel = 0
	Instance.new("UICorner", header).CornerRadius = UDim.new(0, 6)

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Parent = header
	titleLabel.BackgroundTransparency = 1
	titleLabel.Size = UDim2.new(1, -100, 1, 0)
	titleLabel.Position = UDim2.new(0, 10, 0, 0)
	titleLabel.Text = title or "Script BY Azka"
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.TextSize = 16
	titleLabel.TextColor3 = theme.TextColor
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left

	-- Gear button (settings)
	local gear = Instance.new("TextButton")
	gear.Parent = header
	gear.BackgroundTransparency = 1
	gear.Size = UDim2.new(0, 30, 0, 30)
	gear.Position = UDim2.new(1, -90, 0, 0)
	gear.Text = "âš™"
	gear.Font = Enum.Font.GothamBold
	gear.TextSize = 20
	gear.TextColor3 = theme.TextColor
	gear.MouseButton1Click:Connect(function()
		-- Toggle settings UI (akan dibuat nanti)
		if window.Settings then
			window.Settings.Visible = not window.Settings.Visible
		end
	end)

	-- Minimize button
	local minBtn = Instance.new("TextButton")
	minBtn.Parent = header
	minBtn.BackgroundTransparency = 1
	minBtn.Size = UDim2.new(0, 30, 0, 30)
	minBtn.Position = UDim2.new(1, -60, 0, 0)
	minBtn.Text = "â€”"
	minBtn.Font = Enum.Font.GothamBold
	minBtn.TextSize = 20
	minBtn.TextColor3 = theme.TextColor
	minBtn.MouseButton1Click:Connect(function()
		main.Visible = false
		if window.Minimized then
			window.Minimized.Visible = true
		end
	end)

	-- Close button
	local closeBtn = Instance.new("TextButton")
	closeBtn.Parent = header
	closeBtn.BackgroundTransparency = 1
	closeBtn.Size = UDim2.new(0, 30, 0, 30)
	closeBtn.Position = UDim2.new(1, -30, 0, 0)
	closeBtn.Text = "X"
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.TextSize = 16
	closeBtn.TextColor3 = Color3.fromRGB(255, 150, 150)
	closeBtn.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	-- Minimized icon (shoe)
	local minimized = Instance.new("TextButton")
	minimized.Name = "Minimized"
	minimized.Parent = gui
	minimized.BackgroundColor3 = theme.Header
	minimized.Size = UDim2.fromOffset(40, 40)
	minimized.Position = UDim2.new(0.5, -20, 0.5, -20)
	minimized.Text = "ðŸ‘Ÿ"
	minimized.Font = Enum.Font.GothamBold
	minimized.TextSize = 20
	minimized.TextColor3 = theme.TextColor
	minimized.Visible = false
	Instance.new("UICorner", minimized).CornerRadius = UDim.new(1, 0)
	makeDraggable(minimized, minimized)
	minimized.MouseButton1Click:Connect(function()
		minimized.Visible = false
		main.Visible = true
	end)
	window.Minimized = minimized

	-- Sidebar (tabs)
	local sidebar = Instance.new("Frame")
	sidebar.Name = "Sidebar"
	sidebar.Parent = main
	sidebar.BackgroundColor3 = theme.Header
	sidebar.Size = UDim2.new(0, 150, 1, -30)
	sidebar.Position = UDim2.new(0, 0, 0, 30)
	sidebar.BorderSizePixel = 0
	Instance.new("UICorner", sidebar).CornerRadius = UDim.new(0, 6)

	local tabContainer = Instance.new("Frame")
	tabContainer.Parent = sidebar
	tabContainer.BackgroundTransparency = 1
	tabContainer.Size = UDim2.new(1, -10, 1, -10)
	tabContainer.Position = UDim2.new(0, 5, 0, 5)

	local tabList = Instance.new("UIListLayout", tabContainer)
	tabList.SortOrder = Enum.SortOrder.LayoutOrder
	tabList.Padding = UDim.new(0, 5)

	-- Content area
	local content = Instance.new("Frame")
	content.Name = "Content"
	content.Parent = main
	content.BackgroundTransparency = 1
	content.Size = UDim2.new(1, -160, 1, -40)
	content.Position = UDim2.new(0, 155, 0, 35)
	content.ClipsDescendants = true

	local pageContainer = Instance.new("Frame")
	pageContainer.Parent = content
	pageContainer.BackgroundTransparency = 1
	pageContainer.Size = UDim2.new(1, 0, 1, 0)

	local pages = {}  -- menyimpan frame tab

	-- Fungsi untuk membuat tab
	function window:NewTab(name)
		local tab = {}
		-- Tab button
		local tabBtn = Instance.new("TextButton")
		tabBtn.Parent = tabContainer
		tabBtn.BackgroundColor3 = theme.SchemeColor
		tabBtn.BackgroundTransparency = 1
		tabBtn.Size = UDim2.new(1, 0, 0, 30)
		tabBtn.Text = name
		tabBtn.Font = Enum.Font.GothamMedium
		tabBtn.TextSize = 14
		tabBtn.TextColor3 = theme.TextColor
		tabBtn.AutoButtonColor = false
		Instance.new("UICorner", tabBtn).CornerRadius = UDim.new(0, 6)

		-- Page frame
		local page = Instance.new("ScrollingFrame")
		page.Name = name
		page.Parent = pageContainer
		page.BackgroundColor3 = theme.Background
		page.BackgroundTransparency = 1
		page.Size = UDim2.new(1, 0, 1, 0)
		page.ScrollBarThickness = 6
		page.ScrollBarImageColor3 = theme.SchemeColor
		page.BorderSizePixel = 0
		page.Visible = false
		page.CanvasSize = UDim2.new(0, 0, 0, 0)

		local pageLayout = Instance.new("UIListLayout", page)
		pageLayout.Padding = UDim.new(0, 10)
		pageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		pageLayout.SortOrder = Enum.SortOrder.LayoutOrder

		-- Update canvas size when children change
		local function updateCanvas()
			local size = pageLayout.AbsoluteContentSize
			page.CanvasSize = UDim2.new(0, size.X, 0, size.Y + 10)
		end
		page.ChildAdded:Connect(updateCanvas)
		page.ChildRemoved:Connect(updateCanvas)
		pageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

		-- Tab switching
		tabBtn.MouseButton1Click:Connect(function()
			for _, btn in ipairs(tabContainer:GetChildren()) do
				if btn:IsA("TextButton") then
					btn.BackgroundTransparency = 1
				end
			end
			for _, p in ipairs(pageContainer:GetChildren()) do
				if p:IsA("ScrollingFrame") then
					p.Visible = false
				end
			end
			tabBtn.BackgroundTransparency = 0
			page.Visible = true
		end)

		-- Jika ini tab pertama, aktifkan
		if #tabContainer:GetChildren() == 1 then
			tabBtn.BackgroundTransparency = 0
			page.Visible = true
		end

		-- Fungsi membuat section
		function tab:NewSection(sectionName)
			local section = {}

			local sectionFrame = Instance.new("Frame")
			sectionFrame.Parent = page
			sectionFrame.BackgroundColor3 = theme.Background
			sectionFrame.BorderSizePixel = 0
			sectionFrame.Size = UDim2.new(1, -10, 0, 0)
			sectionFrame.AutomaticSize = Enum.AutomaticSize.Y

			local header = Instance.new("Frame")
			header.Parent = sectionFrame
			header.BackgroundColor3 = theme.SchemeColor
			header.Size = UDim2.new(1, 0, 0, 30)
			header.BorderSizePixel = 0
			Instance.new("UICorner", header).CornerRadius = UDim.new(0, 6)

			local title = Instance.new("TextLabel")
			title.Parent = header
			title.BackgroundTransparency = 1
			title.Size = UDim2.new(1, -10, 1, 0)
			title.Position = UDim2.new(0, 5, 0, 0)
			title.Text = sectionName
			title.Font = Enum.Font.GothamBold
			title.TextSize = 14
			title.TextColor3 = theme.TextColor
			title.TextXAlignment = Enum.TextXAlignment.Left

			local contentFrame = Instance.new("Frame")
			contentFrame.Parent = sectionFrame
			contentFrame.BackgroundTransparency = 1
			contentFrame.Size = UDim2.new(1, 0, 0, 0)
			contentFrame.Position = UDim2.new(0, 0, 0, 35)
			contentFrame.AutomaticSize = Enum.AutomaticSize.Y

			local contentLayout = Instance.new("UIListLayout", contentFrame)
			contentLayout.Padding = UDim.new(0, 5)
			contentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
			contentLayout.SortOrder = Enum.SortOrder.LayoutOrder

			-- Element creation functions
			function section:NewButton(text, tip, callback)
				local btn = Instance.new("TextButton")
				btn.Parent = contentFrame
				btn.BackgroundColor3 = theme.ElementColor
				btn.Size = UDim2.new(1, -10, 0, 35)
				btn.Text = ""
				btn.AutoButtonColor = false
				Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

				local label = Instance.new("TextLabel")
				label.Parent = btn
				label.BackgroundTransparency = 1
				label.Size = UDim2.new(1, -10, 1, 0)
				label.Position = UDim2.new(0, 5, 0, 0)
				label.Text = text
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left

				btn.MouseButton1Click:Connect(function()
					if callback then callback() end
					-- animasi klik (opsional)
				end)
			end

			function section:NewToggle(text, tip, default, callback)
				local toggled = default or false
				local toggleBtn = Instance.new("TextButton")
				toggleBtn.Parent = contentFrame
				toggleBtn.BackgroundColor3 = theme.ElementColor
				toggleBtn.Size = UDim2.new(1, -10, 0, 35)
				toggleBtn.Text = ""
				toggleBtn.AutoButtonColor = false
				Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 6)

				local label = Instance.new("TextLabel")
				label.Parent = toggleBtn
				label.BackgroundTransparency = 1
				label.Size = UDim2.new(1, -50, 1, 0)
				label.Position = UDim2.new(0, 5, 0, 0)
				label.Text = text
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left

				local toggleIndicator = Instance.new("Frame")
				toggleIndicator.Parent = toggleBtn
				toggleIndicator.BackgroundColor3 = theme.SchemeColor
				toggleIndicator.Size = UDim2.new(0, 20, 0, 20)
				toggleIndicator.Position = UDim2.new(1, -25, 0.5, -10)
				Instance.new("UICorner", toggleIndicator).CornerRadius = UDim.new(1, 0)

				local function updateColor()
					toggleIndicator.BackgroundColor3 = toggled and Color3.fromRGB(0, 255, 0) or theme.SchemeColor
				end
				updateColor()

				toggleBtn.MouseButton1Click:Connect(function()
					toggled = not toggled
					updateColor()
					if callback then callback(toggled) end
				end)

				return function() return toggled end
			end

			function section:NewSlider(text, tip, min, max, default, callback)
				local value = default or min
				local sliderFrame = Instance.new("Frame")
				sliderFrame.Parent = contentFrame
				sliderFrame.BackgroundColor3 = theme.ElementColor
				sliderFrame.Size = UDim2.new(1, -10, 0, 45)
				Instance.new("UICorner", sliderFrame).CornerRadius = UDim.new(0, 6)

				local label = Instance.new("TextLabel")
				label.Parent = sliderFrame
				label.BackgroundTransparency = 1
				label.Size = UDim2.new(1, -10, 0, 20)
				label.Position = UDim2.new(0, 5, 0, 2)
				label.Text = text
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left

				local valueLabel = Instance.new("TextLabel")
				valueLabel.Parent = sliderFrame
				valueLabel.BackgroundTransparency = 1
				valueLabel.Size = UDim2.new(0, 50, 0, 20)
				valueLabel.Position = UDim2.new(1, -55, 0, 2)
				valueLabel.Text = tostring(value)
				valueLabel.Font = Enum.Font.GothamBold
				valueLabel.TextSize = 14
				valueLabel.TextColor3 = theme.SchemeColor
				valueLabel.TextXAlignment = Enum.TextXAlignment.Right

				local bar = Instance.new("Frame")
				bar.Parent = sliderFrame
				bar.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
				bar.Size = UDim2.new(1, -20, 0, 10)
				bar.Position = UDim2.new(0, 10, 0, 25)
				Instance.new("UICorner", bar).CornerRadius = UDim.new(1, 0)

				local fill = Instance.new("Frame")
				fill.Parent = bar
				fill.BackgroundColor3 = theme.SchemeColor
				fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
				Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)

				local knob = Instance.new("Frame")
				knob.Parent = bar
				knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
				knob.Size = UDim2.new(0, 14, 0, 14)
				knob.Position = UDim2.new((value - min) / (max - min), -7, 0.5, -7)
				Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)

				local dragging = false
				local function updateFromMouse(x)
					local barPos = bar.AbsolutePosition.X
					local barSize = bar.AbsoluteSize.X
					local relX = math.clamp(x - barPos, 0, barSize)
					local alpha = relX / barSize
					value = math.floor(min + alpha * (max - min) + 0.5)
					valueLabel.Text = tostring(value)
					fill.Size = UDim2.new(alpha, 0, 1, 0)
					knob.Position = UDim2.new(alpha, -7, 0.5, -7)
					if callback then callback(value) end
				end

				knob.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = true
					end
				end)
				bar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = true
						updateFromMouse(input.Position.X)
					end
				end)
				UserInputService.InputChanged:Connect(function(input)
					if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement) then
						updateFromMouse(input.Position.X)
					end
				end)
				UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = false
					end
				end)
			end

			function section:NewDropdown(text, tip, options, callback)
				local dropdown = Instance.new("TextButton")
				dropdown.Parent = contentFrame
				dropdown.BackgroundColor3 = theme.ElementColor
				dropdown.Size = UDim2.new(1, -10, 0, 35)
				dropdown.Text = ""
				dropdown.AutoButtonColor = false
				Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0, 6)

				local label = Instance.new("TextLabel")
				label.Parent = dropdown
				label.BackgroundTransparency = 1
				label.Size = UDim2.new(1, -30, 1, 0)
				label.Position = UDim2.new(0, 5, 0, 0)
				label.Text = text .. ": " .. (options[1] or "")
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left

				local arrow = Instance.new("TextLabel")
				arrow.Parent = dropdown
				arrow.BackgroundTransparency = 1
				arrow.Size = UDim2.new(0, 20, 1, 0)
				arrow.Position = UDim2.new(1, -25, 0, 0)
				arrow.Text = "â–¼"
				arrow.Font = Enum.Font.GothamBold
				arrow.TextSize = 14
				arrow.TextColor3 = theme.SchemeColor

				local expanded = false
				local dropdownList = Instance.new("Frame")
				dropdownList.Parent = contentFrame
				dropdownList.BackgroundColor3 = theme.ElementColor
				dropdownList.Size = UDim2.new(1, -10, 0, 0)
				dropdownList.Visible = false
				dropdownList.ClipsDescendants = true
				dropdownList.AutomaticSize = Enum.AutomaticSize.Y
				Instance.new("UICorner", dropdownList).CornerRadius = UDim.new(0, 6)

				local listLayout = Instance.new("UIListLayout", dropdownList)
				listLayout.Padding = UDim.new(0, 2)
				listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

				for _, opt in ipairs(options) do
					local optBtn = Instance.new("TextButton")
					optBtn.Parent = dropdownList
					optBtn.BackgroundColor3 = theme.ElementColor
					optBtn.Size = UDim2.new(1, -10, 0, 30)
					optBtn.Text = opt
					optBtn.Font = Enum.Font.GothamMedium
					optBtn.TextSize = 14
					optBtn.TextColor3 = theme.TextColor
					optBtn.AutoButtonColor = false
					Instance.new("UICorner", optBtn).CornerRadius = UDim.new(0, 6)
					optBtn.MouseButton1Click:Connect(function()
						label.Text = text .. ": " .. opt
						if callback then callback(opt) end
						expanded = false
						dropdownList.Visible = false
					end)
				end

				dropdown.MouseButton1Click:Connect(function()
					expanded = not expanded
					dropdownList.Visible = expanded
				end)
			end

			function section:NewKeybind(text, tip, defaultKey, callback)
				local key = defaultKey or "E"
				local btn = Instance.new("TextButton")
				btn.Parent = contentFrame
				btn.BackgroundColor3 = theme.ElementColor
				btn.Size = UDim2.new(1, -10, 0, 35)
				btn.Text = ""
				btn.AutoButtonColor = false
				Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

				local label = Instance.new("TextLabel")
				label.Parent = btn
				label.BackgroundTransparency = 1
				label.Size = UDim2.new(1, -60, 1, 0)
				label.Position = UDim2.new(0, 5, 0, 0)
				label.Text = text
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left

				local keyLabel = Instance.new("TextLabel")
				keyLabel.Parent = btn
				keyLabel.BackgroundTransparency = 1
				keyLabel.Size = UDim2.new(0, 50, 1, 0)
				keyLabel.Position = UDim2.new(1, -55, 0, 0)
				keyLabel.Text = key
				keyLabel.Font = Enum.Font.GothamBold
				keyLabel.TextSize = 14
				keyLabel.TextColor3 = theme.SchemeColor
				keyLabel.TextXAlignment = Enum.TextXAlignment.Right

				btn.MouseButton1Click:Connect(function()
					keyLabel.Text = "..."
					local con
					con = UserInputService.InputBegan:Connect(function(input)
						if input.UserInputType == Enum.UserInputType.Keyboard then
							key = input.KeyCode.Name
							keyLabel.Text = key
							con:Disconnect()
						end
					end)
				end)

				UserInputService.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode.Name == key then
						if callback then callback() end
					end
				end)
			end

			function section:NewLabel(text)
				local label = Instance.new("TextLabel")
				label.Parent = contentFrame
				label.BackgroundColor3 = theme.ElementColor
				label.Size = UDim2.new(1, -10, 0, 30)
				label.Text = "  " .. text
				label.Font = Enum.Font.GothamMedium
				label.TextSize = 14
				label.TextColor3 = theme.TextColor
				label.TextXAlignment = Enum.TextXAlignment.Left
				Instance.new("UICorner", label).CornerRadius = UDim.new(0, 6)
			end

			return section
		end

		table.insert(pages, page)
		return tab
	end

	-- Settings panel (akan dipanggil oleh gear)
	local settingsFrame = Instance.new("Frame")
	settingsFrame.Name = "Settings"
	settingsFrame.Parent = gui
	settingsFrame.BackgroundColor3 = theme.Background
	settingsFrame.Size = UDim2.fromOffset(300, 200)
	settingsFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
	settingsFrame.Visible = false
	Instance.new("UICorner", settingsFrame).CornerRadius = UDim.new(0, 6)
	makeDraggable(settingsFrame, settingsFrame)

	local settingsHeader = Instance.new("Frame")
	settingsHeader.Parent = settingsFrame
	settingsHeader.BackgroundColor3 = theme.Header
	settingsHeader.Size = UDim2.new(1, 0, 0, 30)
	Instance.new("UICorner", settingsHeader).CornerRadius = UDim.new(0, 6)

	local settingsTitle = Instance.new("TextLabel")
	settingsTitle.Parent = settingsHeader
	settingsTitle.BackgroundTransparency = 1
	settingsTitle.Size = UDim2.new(1, -40, 1, 0)
	settingsTitle.Position = UDim2.new(0, 10, 0, 0)
	settingsTitle.Text = "Settings"
	settingsTitle.Font = Enum.Font.GothamBold
	settingsTitle.TextSize = 16
	settingsTitle.TextColor3 = theme.TextColor
	settingsTitle.TextXAlignment = Enum.TextXAlignment.Left

	local settingsClose = Instance.new("TextButton")
	settingsClose.Parent = settingsHeader
	settingsClose.BackgroundTransparency = 1
	settingsClose.Size = UDim2.new(0, 30, 0, 30)
	settingsClose.Position = UDim2.new(1, -30, 0, 0)
	settingsClose.Text = "X"
	settingsClose.Font = Enum.Font.GothamBold
	settingsClose.TextSize = 16
	settingsClose.TextColor3 = Color3.fromRGB(255, 150, 150)
	settingsClose.MouseButton1Click:Connect(function()
		settingsFrame.Visible = false
	end)

	local settingsContent = Instance.new("Frame")
	settingsContent.Parent = settingsFrame
	settingsContent.BackgroundTransparency = 1
	settingsContent.Size = UDim2.new(1, -20, 1, -40)
	settingsContent.Position = UDim2.new(0, 10, 0, 35)

	local settingsLayout = Instance.new("UIListLayout", settingsContent)
	settingsLayout.Padding = UDim.new(0, 5)
	settingsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

	-- Anti-AFK toggle
	local afkToggled = false
	local afkBtn = Instance.new("TextButton")
	afkBtn.Parent = settingsContent
	afkBtn.BackgroundColor3 = theme.ElementColor
	afkBtn.Size = UDim2.new(1, 0, 0, 35)
	afkBtn.Text = ""
	afkBtn.AutoButtonColor = false
	Instance.new("UICorner", afkBtn).CornerRadius = UDim.new(0, 6)

	local afkLabel = Instance.new("TextLabel")
	afkLabel.Parent = afkBtn
	afkLabel.BackgroundTransparency = 1
	afkLabel.Size = UDim2.new(1, -50, 1, 0)
	afkLabel.Position = UDim2.new(0, 5, 0, 0)
	afkLabel.Text = "Anti-AFK"
	afkLabel.Font = Enum.Font.GothamMedium
	afkLabel.TextSize = 14
	afkLabel.TextColor3 = theme.TextColor
	afkLabel.TextXAlignment = Enum.TextXAlignment.Left

	local afkIndicator = Instance.new("Frame")
	afkIndicator.Parent = afkBtn
	afkIndicator.BackgroundColor3 = theme.SchemeColor
	afkIndicator.Size = UDim2.new(0, 20, 0, 20)
	afkIndicator.Position = UDim2.new(1, -25, 0.5, -10)
	Instance.new("UICorner", afkIndicator).CornerRadius = UDim.new(1, 0)

	afkBtn.MouseButton1Click:Connect(function()
		afkToggled = not afkToggled
		afkIndicator.BackgroundColor3 = afkToggled and Color3.fromRGB(0, 255, 0) or theme.SchemeColor
	end)

	-- Server Hop button
	local hopBtn = Instance.new("TextButton")
	hopBtn.Parent = settingsContent
	hopBtn.BackgroundColor3 = theme.ElementColor
	hopBtn.Size = UDim2.new(1, 0, 0, 35)
	hopBtn.Text = "Server Hop & Rejoin"
	hopBtn.Font = Enum.Font.GothamMedium
	hopBtn.TextSize = 14
	hopBtn.TextColor3 = theme.TextColor
	Instance.new("UICorner", hopBtn).CornerRadius = UDim.new(0, 6)
	hopBtn.MouseButton1Click:Connect(function()
		local ts = game:GetService("TeleportService")
		ts:Teleport(game.PlaceId, player, nil, game.JobId)
	end)

	-- Respawn button
	local respawnBtn = Instance.new("TextButton")
	respawnBtn.Parent = settingsContent
	respawnBtn.BackgroundColor3 = theme.ElementColor
	respawnBtn.Size = UDim2.new(1, 0, 0, 35)
	respawnBtn.Text = "Character Respawn"
	respawnBtn.Font = Enum.Font.GothamMedium
	respawnBtn.TextSize = 14
	respawnBtn.TextColor3 = theme.TextColor
	Instance.new("UICorner", respawnBtn).CornerRadius = UDim.new(0, 6)
	respawnBtn.MouseButton1Click:Connect(function()
		local char = player.Character
		if char then char:BreakJoints() end
	end)

	-- Anti-AFK loop
	task.spawn(function()
		local vu = game:GetService("VirtualUser")
		player.Idled:Connect(function()
			if afkToggled then
				vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
				task.wait(1)
				vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
			end
		end)
	end)

	window.Settings = settingsFrame
	return window
end

-- ========== FEATURE IMPLEMENTATION ==========
-- State variables
local currentWS = 30
local currentBoost = 0
local godModeEnabled = false
local instantProxEnabled = false
local infiniteZoomEnabled = false
local freecamEnabled = false
local freecamPart = Instance.new("Part")
freecamPart.Anchored = true
freecamPart.CanCollide = false
freecamPart.Transparency = 1
freecamPart.Size = Vector3.new(1,1,1)
freecamPart.Parent = workspace

local freecamInfo = Instance.new("TextLabel")
freecamInfo.Size = UDim2.fromOffset(200, 30)
freecamInfo.Position = UDim2.new(0, 10, 0, 10)
freecamInfo.BackgroundColor3 = theme.Background
freecamInfo.TextColor3 = Color3.new(1,1,1)
freecamInfo.Text = "Freecam ON (WASD/SPACE/CTRL) - Shift to speed"
freecamInfo.Font = Enum.Font.GothamBold
freecamInfo.TextSize = 14
freecamInfo.Visible = false
freecamInfo.Parent = folder
makeDraggable(freecamInfo, freecamInfo)

-- Fly UI
local flyGui = Instance.new("ScreenGui")
flyGui.Name = "FlyUI"
flyGui.Parent = folder
flyGui.ResetOnSpawn = false
local flyFrame = Instance.new("Frame")
flyFrame.Parent = flyGui
flyFrame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
flyFrame.Size = UDim2.fromOffset(190, 57)
flyFrame.Position = UDim2.new(0.1, 0, 0.38, 0)
flyFrame.Visible = false
flyFrame.Draggable = true
-- (isi fly UI seperti sebelumnya, disederhanakan)
-- Untuk menghemat waktu, kita bisa membuat fly UI sederhana atau menggunakan yang lama.

-- Tapi karena permintaan "rombak semua UI", kita akan membuat fly UI sebagai panel terpisah dengan toggle di main UI.
-- Kita buat fly UI sederhana dengan tombol UP/DOWN dan speed.

-- Fungsi untuk membuat fly UI
local function createFlyUI()
	local frame = Instance.new("Frame")
	frame.Parent = flyGui
	frame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
	frame.Size = UDim2.fromOffset(190, 57)
	frame.Position = UDim2.new(0.1, 0, 0.38, 0)
	frame.Visible = false
	frame.Draggable = true
	Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 6)

	local title = Instance.new("TextLabel")
	title.Parent = frame
	title.BackgroundTransparency = 1
	title.Size = UDim2.new(1, -10, 0, 20)
	title.Position = UDim2.new(0, 5, 0, 2)
	title.Text = "Azka Fly"
	title.Font = Enum.Font.GothamBold
	title.TextSize = 14
	title.TextColor3 = Color3.new(0,0,0)

	local up = Instance.new("TextButton")
	up.Parent = frame
	up.BackgroundColor3 = Color3.fromRGB(79, 255, 152)
	up.Size = UDim2.fromOffset(44, 28)
	up.Position = UDim2.new(0, 5, 0, 25)
	up.Text = "UP"
	up.Font = Enum.Font.GothamBold
	up.TextSize = 12
	up.TextColor3 = Color3.new(0,0,0)
	Instance.new("UICorner", up).CornerRadius = UDim.new(0, 4)

	local down = Instance.new("TextButton")
	down.Parent = frame
	down.BackgroundColor3 = Color3.fromRGB(215, 255, 121)
	down.Size = UDim2.fromOffset(44, 28)
	down.Position = UDim2.new(0, 54, 0, 25)
	down.Text = "DOWN"
	down.Font = Enum.Font.GothamBold
	down.TextSize = 12
	down.TextColor3 = Color3.new(0,0,0)
	Instance.new("UICorner", down).CornerRadius = UDim.new(0, 4)

	local speedLabel = Instance.new("TextLabel")
	speedLabel.Parent = frame
	speedLabel.BackgroundColor3 = Color3.fromRGB(255, 85, 0)
	speedLabel.Size = UDim2.fromOffset(44, 28)
	speedLabel.Position = UDim2.new(0, 103, 0, 25)
	speedLabel.Text = "1"
	speedLabel.Font = Enum.Font.GothamBold
	speedLabel.TextSize = 14
	speedLabel.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", speedLabel).CornerRadius = UDim.new(0, 4)

	local close = Instance.new("TextButton")
	close.Parent = frame
	close.BackgroundColor3 = Color3.fromRGB(225, 25, 0)
	close.Size = UDim2.fromOffset(30, 20)
	close.Position = UDim2.new(1, -35, 0, 2)
	close.Text = "X"
	close.Font = Enum.Font.GothamBold
	close.TextSize = 14
	close.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", close).CornerRadius = UDim.new(0, 4)
	close.MouseButton1Click:Connect(function()
		frame.Visible = false
	end)

	local speed = 1
	up.MouseButton1Down:Connect(function()
		while up and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) do
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame * CFrame.new(0, speed, 0)
			end
			task.wait()
		end
	end)

	down.MouseButton1Down:Connect(function()
		while down and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) do
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				char.HumanoidRootPart.CFrame = char.HumanoidRootPart.CFrame * CFrame.new(0, -speed, 0)
			end
			task.wait()
		end
	end)

	-- Speed bisa diatur dengan scroll atau tombol, sederhana saja
	return frame
end

local flyPanel = createFlyUI()

-- Teleport UI
local tpGui = Instance.new("ScreenGui")
tpGui.Name = "TeleportUI"
tpGui.Parent = folder
tpGui.ResetOnSpawn = false
local tpMain = Instance.new("Frame")
tpMain.Parent = tpGui
tpMain.BackgroundColor3 = theme.Background
tpMain.Size = UDim2.fromOffset(400, 450)
tpMain.Position = UDim2.new(0.5, -200, 0.3, -225)
tpMain.Visible = false
tpMain.Draggable = true
Instance.new("UICorner", tpMain).CornerRadius = UDim.new(0, 6)
-- (isi TP UI seperti sebelumnya, sederhanakan)

-- ========== BUILD MAIN UI ==========
local AzkaUI = Library:CreateWindow("Script BY Azka")

-- Tab Utama
local mainTab = AzkaUI:NewTab("Main")
local mainSection = mainTab:NewSection("Controls")

-- WalkSpeed Slider
mainSection:NewSlider("WalkSpeed", "Kecepatan jalan", 1, 200, 30, function(val)
	currentWS = val
end)

-- Boost Slider
mainSection:NewSlider("Boost", "Tambahan kecepatan", 0, 500, 0, function(val)
	currentBoost = val
end)

-- Row 1 toggles (Noclip, Inf Jump, Fly UI, TP UI)
local noclipToggle = mainSection:NewToggle("Noclip", "Tembus dinding", false, function(state)
	-- noclip logic
end)

local infJumpToggle = mainSection:NewToggle("Inf Jump", "Lompat tanpa batas", false, function(state)
	-- inf jump logic
end)

local flyUIToggle = mainSection:NewToggle("Fly UI", "Tampilkan panel fly", false, function(state)
	flyPanel.Visible = state
end)

local tpUIToggle = mainSection:NewToggle("TP UI", "Tampilkan panel teleport", false, function(state)
	tpMain.Visible = state
end)

-- Row 2 toggles (God Mode, Instant Proximity, Infinite Zoom, Freecam)
local godModeToggle = mainSection:NewToggle("God Mode", "Tak terkalahkan", false, function(state)
	godModeEnabled = state
end)

local instantProxToggle = mainSection:NewToggle("Instant Proximity", "Interaksi instan", false, function(state)
	instantProxEnabled = state
end)

local infiniteZoomToggle = mainSection:NewToggle("Infinite Zoom", "Zoom tak terbatas", false, function(state)
	infiniteZoomEnabled = state
end)

local freecamToggle = mainSection:NewToggle("Freecam", "Kamera bebas", false, function(state)
	freecamEnabled = state
	freecamInfo.Visible = state
	if state then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			freecamPart.CFrame = char.HumanoidRootPart.CFrame
		end
	else
		-- kembalikan kamera ke karakter
		local char = player.Character
		if char and char:FindFirstChild("Humanoid") then
			Camera.CameraSubject = char.Humanoid
		end
	end
end)

-- Row 3 toggles (FPS UI, Script Lib)
local fpsUIToggle = mainSection:NewToggle("FPS UI", "Fitur ESP dll", false, function(state)
	-- nanti buat FPS UI
end)

local scriptLibToggle = mainSection:NewToggle("Script Lib", "Koleksi script", false, function(state)
	-- nanti buat
end)

-- Tab Teleport
local tpTab = AzkaUI:NewTab("Teleport")
local tpSection = tpTab:NewSection("Teleport Manager")

-- Live Players List
tpSection:NewLabel("Live Players")
-- Di sini kita bisa menambahkan dropdown atau list dinamis. Untuk sederhana, kita buat tombol refresh.
tpSection:NewButton("Refresh Players", "Perbarui daftar pemain", function()
	-- Hapus semua tombol player sebelumnya dan buat ulang
end)

-- Tampilkan semua player sebagai tombol teleport
-- Kita akan buat fungsi untuk update list secara dinamis nanti

-- Saved Teleports
tpSection:NewLabel("Saved Teleports")
tpSection:NewButton("Save Current Position", "Simpan lokasi sekarang", function()
	-- simpan ke _G.AzkaTeleports
end)
-- Untuk menampilkan saved teleports, kita bisa tambahkan dropdown atau scrolling list.

-- Tab FPS (placeholder)
local fpsTab = AzkaUI:NewTab("FPS")
local fpsSection = fpsTab:NewSection("ESP Settings")
fpsSection:NewToggle("ESP", "", false, function() end)
fpsSection:NewToggle("ESP Boxes", "", false, function() end)
fpsSection:NewToggle("Health", "", false, function() end)
fpsSection:NewToggle("Display Name", "", false, function() end)
fpsSection:NewToggle("Equipped Item", "", false, function() end)
fpsSection:NewToggle("Distance", "", false, function() end)
fpsSection:NewToggle("Tracers", "", false, function() end)
fpsSection:NewToggle("Team Color", "", false, function() end)

-- Tab Settings (sudah ada di gear)

-- ========== FEATURE LOOPS ==========
-- WalkSpeed enforcer
task.spawn(function()
	local hum = waitForHumanoid()
	player.CharacterAdded:Connect(function()
		hum = waitForHumanoid()
	end)
	while true do
		if hum and hum.Parent then
			hum.WalkSpeed = currentWS + currentBoost
		end
		task.wait(0.01)
	end
end)

-- Inf Jump
task.spawn(function()
	local hum = waitForHumanoid()
	player.CharacterAdded:Connect(function()
		hum = waitForHumanoid()
	end)
	UserInputService.JumpRequest:Connect(function()
		if infJumpToggle and type(infJumpToggle) == "function" and infJumpToggle() then
			if hum and hum.Parent then
				hum:ChangeState(Enum.HumanoidStateType.Jumping)
				hum.Jump = true
			end
		end
	end)
end)

-- Noclip
task.spawn(function()
	while true do
		if noclipToggle and type(noclipToggle) == "function" and noclipToggle() then
			local char = player.Character
			if char then
				for _, obj in ipairs(char:GetDescendants()) do
					if obj:IsA("BasePart") then
						obj.CanCollide = false
					end
				end
			end
		end
		RunService.Stepped:Wait()
	end
end)

-- God Mode
task.spawn(function()
	local hum = waitForHumanoid()
	player.CharacterAdded:Connect(function()
		hum = waitForHumanoid()
	end)
	while true do
		if godModeEnabled and hum and hum.Parent then
			hum.MaxHealth = math.huge
			hum.Health = hum.MaxHealth
		end
		task.wait(0.1)
	end
end)

-- Instant Proximity
task.spawn(function()
	while true do
		if instantProxEnabled then
			for _, v in ipairs(workspace:GetDescendants()) do
				if v:IsA("ProximityPrompt") then
					v.HoldDuration = 0
				end
			end
		end
		task.wait(2)
	end
end)

-- Infinite Zoom
task.spawn(function()
	while true do
		if infiniteZoomEnabled then
			Camera.MaxAxisFieldOfView = 180
			Camera.FieldOfView = 120
		else
			Camera.MaxAxisFieldOfView = 120
		end
		task.wait(0.5)
	end
end)

-- Freecam
local freecamSpeed = 0.5
UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.LeftShift then
		freecamSpeed = 2
	end
end)
UserInputService.InputEnded:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.LeftShift then
		freecamSpeed = 0.5
	end
end)

RunService.RenderStepped:Connect(function()
	if freecamEnabled then
		local move = Vector3.new(
			(UserInputService:IsKeyDown(Enum.KeyCode.D) and 1 or 0) - (UserInputService:IsKeyDown(Enum.KeyCode.A) and 1 or 0),
			(UserInputService:IsKeyDown(Enum.KeyCode.Space) and 1 or 0) - (UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) and 1 or 0),
			(UserInputService:IsKeyDown(Enum.KeyCode.S) and 1 or 0) - (UserInputService:IsKeyDown(Enum.KeyCode.W) and 1 or 0)
		) * freecamSpeed
		freecamPart.CFrame = freecamPart.CFrame + move
		Camera.CFrame = CFrame.new(freecamPart.Position, freecamPart.Position + Camera.CFrame.LookVector)
	end
end)

-- Notifikasi load
local notif = Instance.new("TextLabel")
notif.Parent = folder
notif.Size = UDim2.fromOffset(200, 36)
notif.Position = UDim2.new(0.5, -100, 0, 20)
notif.BackgroundColor3 = theme.Background
notif.BackgroundTransparency = 0.2
notif.Text = "Script BY Azka - Loaded"
notif.TextColor3 = theme.TextColor
notif.Font = Enum.Font.Gotham
notif.TextSize = 14
Instance.new("UICorner", notif).CornerRadius = UDim.new(0, 8)

task.wait(2)
TweenService:Create(notif, TweenInfo.new(0.5), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
task.wait(0.5)
notif:Destroy()
